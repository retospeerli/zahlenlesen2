<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Zahlen hÃ¶ren â€“ Bild auswÃ¤hlen</title>

<style>
:root{
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:#eef2ff;
}
*{ box-sizing:border-box; }
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.app{
  width:100%;
  max-width:720px;
  background:#fff;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
  padding:1rem;
}
h1{text-align:center;margin:.2rem 0;}
.subtitle{text-align:center;color:#4b5563;margin-bottom:.6rem;}
.hidden{display:none;}

.card{
  background:#f9fafb;
  border:1px solid #e5e7eb;
  border-radius:16px;
  padding:1rem;
}

label{font-weight:700;margin-top:.6rem;display:block;}
select{
  width:100%;
  padding:.6rem;
  border-radius:12px;
  border:2px solid #d1d5db;
  font-size:1rem;
}

.primary-btn{
  width:100%;
  margin-top:.8rem;
  padding:.8rem;
  border:none;
  border-radius:999px;
  background:#2563eb;
  color:#fff;
  font-weight:800;
  font-size:1.05rem;
}

.big-btn{
  padding:.8rem 1.2rem;
  border-radius:999px;
  border:2px solid #d1d5db;
  background:#fff;
  font-weight:800;
}

.options{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:.6rem;
  margin-top:.6rem;
}
@media(min-width:600px){
  .options{grid-template-columns:repeat(4,1fr);}
}
.img-opt{
  border-radius:14px;
  border:2px solid #d1d5db;
  background:#fff;
  padding:.4rem;
}
.img-opt img{
  width:100%;
  height:100px;
  object-fit:contain;
}

.feedback{
  text-align:center;
  font-weight:800;
  margin-top:.4rem;
}
.ok{color:#15803d;}
.err{color:#b91c1c;}
</style>
</head>

<body>
<div class="app">

<h1>Zahlen hÃ¶ren</h1>
<p class="subtitle">HÃ¶re die Zahl und wÃ¤hle das richtige Bild.</p>

<!-- START -->
<div id="start-screen">
  <div class="card">
    <label>Anzahl Aufgaben</label>
    <select id="count-select">
      <option value="10">10</option>
      <option value="15">15</option>
      <option value="20" selected>20</option>
    </select>

    <label>Stimme (Text-to-Speech)</label>
    <select id="voice-select"></select>
  </div>
  <button class="primary-btn" id="start-btn">Los!</button>
</div>

<!-- QUIZ -->
<div id="quiz-screen" class="hidden">
  <p style="text-align:center;font-weight:700">Welche Zahl hÃ¶rst du?</p>

  <div style="text-align:center">
    <button class="big-btn" id="hear-btn">ðŸ”Š Zahl hÃ¶ren</button>
  </div>

  <div class="options" id="options"></div>
  <div class="feedback" id="feedback"></div>
</div>

<!-- RESULT -->
<div id="result-screen" class="hidden">
  <h2 style="text-align:center">Fertig ðŸŽ‰</h2>
  <p id="result-text" style="text-align:center"></p>
  <button class="primary-btn" id="finish-btn">Fertig</button>
</div>

</div>

<!-- Audio -->
<audio id="sound-correct" src="audio/correct.wav"></audio>
<audio id="sound-error" src="audio/error.wav"></audio>

<script>
const MIN=1, MAX=20;
let voices=[], selectedVoice=null;
let total=20, idx=0, order=[], correct=0, wrong=0, current=null;

const voiceSelect=document.getElementById("voice-select");

function loadVoices(){
  voices = speechSynthesis.getVoices();
  voiceSelect.innerHTML="";

  const german = voices.filter(v=>v.lang.startsWith("de"));
  german.forEach((v,i)=>{
    const o=document.createElement("option");
    o.value=voices.indexOf(v);
    o.textContent=`${v.name} (${v.lang})`;
    voiceSelect.appendChild(o);
  });

  // ðŸ”¹ Default: weiblich / natural / deutsch
  const preferred = german.find(v =>
    /female|anna|katja|helena|google/i.test(v.name)
  ) || german[0];

  if(preferred){
    selectedVoice = preferred;
    voiceSelect.value = voices.indexOf(preferred);
  }
}

if("speechSynthesis"in window){
  loadVoices();
  speechSynthesis.onvoiceschanged = loadVoices;
}

voiceSelect.addEventListener("change",()=>{
  selectedVoice = voices[Number(voiceSelect.value)] || null;
});

function speak(n){
  const u=new SpeechSynthesisUtterance(String(n));
  u.lang="de-CH";
  if(selectedVoice) u.voice=selectedVoice;
  u.rate=.9;
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

document.getElementById("start-btn").onclick=()=>{
  total=Number(document.getElementById("count-select").value);
  order=shuffle([...Array(20).keys()].map(i=>i+1)).slice(0,total);
  idx=0;correct=0;wrong=0;
  document.getElementById("start-screen").classList.add("hidden");
  document.getElementById("quiz-screen").classList.remove("hidden");
  next();
};

function next(){
  current=order[idx];
  speak(current);
  const opts=shuffle([current,rand(),rand(),rand()].filter((v,i,a)=>a.indexOf(v)===i)).slice(0,4);
  const box=document.getElementById("options");
  box.innerHTML="";
  opts.forEach(n=>{
    const b=document.createElement("button");
    b.className="img-opt";
    b.innerHTML=`<img src="images/${n}.png">`;
    b.onclick=()=>choose(n);
    box.appendChild(b);
  });
}

function rand(){return Math.floor(Math.random()*20)+1;}

function choose(n){
  if(n===current){
    correct++;
    document.getElementById("feedback").textContent="Richtig!";
    document.getElementById("feedback").className="feedback ok";
    document.getElementById("sound-correct").play();
  }else{
    wrong++;
    document.getElementById("feedback").textContent="Leider falsch.";
    document.getElementById("feedback").className="feedback err";
    document.getElementById("sound-error").play();
  }
  idx++;
  if(idx>=total){
    document.getElementById("quiz-screen").classList.add("hidden");
    document.getElementById("result-screen").classList.remove("hidden");
    document.getElementById("result-text").innerHTML=
      `Richtig: <b>${correct}</b><br>Falsch: <b>${wrong}</b>`;
  }else{
    setTimeout(next,600);
  }
}

document.getElementById("hear-btn").onclick=()=>speak(current);

document.getElementById("finish-btn").onclick=()=>{
  try{
    window.parent.postMessage("AppSolved","*");
  }catch(e){}
};
</script>
</body>
</html>
